{"version":3,"sources":["R.length.js"],"names":["path2curve","require","findDotsAtSegment","base3","t","p1","p2","p3","p4","t1","t2","bezlen","x1","y1","x2","y2","x3","y3","x4","y4","z","z2","n","Tvalues","Cvalues","sum","i","ct","xbase","ybase","comb","Math","sqrt","getTatLen","ll","step","l","e","abs","getPointAtSegmentLength","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","length","getLengthFactory","istotal","subpath","path","onlystart","x","y","p","sp","subpaths","point","len","ii","start","m","end","join","alpha","shift","getTotalLength","getPointAtLength","getSubpathsAtLength","getSubpath","from","to","a","module","exports"],"mappings":"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","file":"R.length.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\raphael\\utils","sourcesContent":["\r\nvar path2curve = require('./R.curve').path2curve;\r\nvar findDotsAtSegment = require('./R.find').findDotsAtSegment;\r\n\r\nfunction base3(t, p1, p2, p3, p4) {\r\n    var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\r\n        t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\r\n    return t * t2 - 3 * p1 + 3 * p2;\r\n}\r\n\r\nfunction bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\r\n    if (z == null) {\r\n        z = 1;\r\n    }\r\n    z = z > 1 ? 1 : z < 0 ? 0 : z;\r\n    var z2 = z / 2,\r\n        n = 12,\r\n        Tvalues = [-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],\r\n        Cvalues = [0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],\r\n        sum = 0;\r\n    for (var i = 0; i < n; i++) {\r\n        var ct = z2 * Tvalues[i] + z2,\r\n            xbase = base3(ct, x1, x2, x3, x4),\r\n            ybase = base3(ct, y1, y2, y3, y4),\r\n            comb = xbase * xbase + ybase * ybase;\r\n        sum += Cvalues[i] * Math.sqrt(comb);\r\n    }\r\n    return z2 * sum;\r\n}\r\n\r\nfunction getTatLen(x1, y1, x2, y2, x3, y3, x4, y4, ll) {\r\n    if (ll < 0 || bezlen(x1, y1, x2, y2, x3, y3, x4, y4) < ll) {\r\n        return;\r\n    }\r\n    var t = 1,\r\n        step = t / 2,\r\n        t2 = t - step,\r\n        l,\r\n        e = .01;\r\n    l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\r\n    while (Math.abs(l - ll) > e) {\r\n        step /= 2;\r\n        t2 += (l < ll ? 1 : -1) * step;\r\n        l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\r\n    }\r\n    return t2;\r\n}\r\n\r\n\r\nfunction getPointAtSegmentLength (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length) {\r\n    if (!length) {\r\n        return bezlen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y);\r\n    } else {\r\n        return findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, getTatLen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length));\r\n    }\r\n}\r\n\r\nfunction getLengthFactory (istotal, subpath) {\r\n    return function (path, length, onlystart) {\r\n        path = path2curve(path);\r\n        var x, y, p, l, sp = '', subpaths = {}, point,\r\n            len = 0;\r\n        for (var i = 0, ii = path.length; i < ii; i++) {\r\n            p = path[i];\r\n            if (p[0] === 'M') {\r\n                x = +p[1];\r\n                y = +p[2];\r\n            } else {\r\n                l = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\r\n                if (len + l > length) {\r\n                    if (subpath && !subpaths.start) {\r\n                        point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\r\n                        sp += ['C' + point.start.x, point.start.y, point.m.x, point.m.y, point.x, point.y];\r\n                        if (onlystart) {return sp;}\r\n                        subpaths.start = sp;\r\n                        sp = ['M' + point.x, point.y + 'C' + point.n.x, point.n.y, point.end.x, point.end.y, p[5], p[6]].join();\r\n                        len += l;\r\n                        x = +p[5];\r\n                        y = +p[6];\r\n                        continue;\r\n                    }\r\n                    if (!istotal && !subpath) {\r\n                        point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\r\n                        return {x: point.x, y: point.y, alpha: point.alpha};\r\n                    }\r\n                }\r\n                len += l;\r\n                x = +p[5];\r\n                y = +p[6];\r\n            }\r\n            sp += p.shift() + p;\r\n        }\r\n        subpaths.end = sp;\r\n        point = istotal ? len : subpath ? subpaths : findDotsAtSegment(x, y, p[0], p[1], p[2], p[3], p[4], p[5], 1);\r\n        point.alpha && (point = {x: point.x, y: point.y, alpha: point.alpha});\r\n        return point;\r\n    };\r\n}\r\n\r\nvar getTotalLength = getLengthFactory(1);\r\nvar getPointAtLength = getLengthFactory();\r\nvar getSubpathsAtLength = getLengthFactory(0, 1);\r\n\r\n/*\\\r\n * Raphael.getSubpath\r\n [ method ]\r\n **\r\n * Return subpath of a given path from given length to given length.\r\n **\r\n > Parameters\r\n **\r\n - path (string) SVG path string\r\n - from (number) position of the start of the segment\r\n - to (number) position of the end of the segment\r\n **\r\n = (string) pathstring for the segment\r\n\\*/\r\nfunction getSubpath (path, from, to) {\r\n    if (this.getTotalLength(path) - to < 1e-6) {\r\n        return getSubpathsAtLength(path, from).end;\r\n    }\r\n    var a = getSubpathsAtLength(path, to, 1);\r\n    return from ? getSubpathsAtLength(a, from).end : a;\r\n}\r\n\r\nmodule.exports = {\r\n    getTatLen: getTatLen,\r\n    bezlen: bezlen,\r\n    getTotalLength: getTotalLength,\r\n    getPointAtLength: getPointAtLength,\r\n    getSubpathsAtLength: getSubpathsAtLength,\r\n    getSubpath: getSubpath\r\n};\r\n"]}